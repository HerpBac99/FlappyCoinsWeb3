# Архитектура проекта FlappyCoin

## Общее описание
FlappyCoin - это многопользовательская игра в стиле FlappyBird для Telegram Mini Apps с криптовалютной тематикой. Игроки управляют монетой, которая летит через трубы, соревнуясь друг с другом.

## Технический стек
- **Сервер**: Node.js, Express.js, Socket.IO
- **Клиент**: HTML, CSS, JavaScript, Canvas API
- **Коммуникация**: WebSocket через Socket.IO
- **Контейнеризация**: Docker, Docker Compose
- **SSL**: Let's Encrypt через certbot

## Структура проекта
```
FlappyCoin/
├── client/                # Клиентская часть
│   ├── index.html         # Главная страница (меню)
│   ├── room.html          # Страница комнаты ожидания
│   ├── game.html          # Страница игры
│   ├── game.js            # Логика игры (Canvas, управление)
│   ├── Style/             # CSS-стили
│   │   ├── mainMenu.css   # Стили главного меню
│   │   ├── room.css       # Стили страницы комнаты
│   │   └── game.css       # Стили игры
│   └── assets/            # Графические ресурсы
│       ├── bitcoin.png    # Спрайт монеты Bitcoin
│       └── default-avatar.png # Аватар по умолчанию
├── server/                # Серверная часть
│   ├── server.js          # Основной сервер (Express + Socket.IO)
│   ├── rooms.js           # Логика управления комнатами
│   └── telegramUsers.json # Хранение данных игроков
├── nginx/                 # Конфигурация Nginx
│   ├── nginx.conf         # Основная конфигурация
│   └── conf.d/            # Папка с конфигурациями доменов
│       └── default.conf   # Конфигурация домена
├── .env                   # Переменные окружения
├── Dockerfile             # Конфигурация контейнера
├── docker-compose.yml     # Конфигурация Docker Compose
└── package.json           # Зависимости и скрипты проекта
```

## Компоненты и их функции

### Клиентская часть

#### 1. Главное меню (index.html)
- Отображение данных пользователя из Telegram
- Анимированная монета в центре экрана
- Кнопки для создания и присоединения к комнате
- WebSocket-подключение для получения списка комнат

#### 2. Комната ожидания (room.html)
- Отображение списка игроков в комнате
- Индикация статуса готовности игроков
- Обратный отсчет перед началом игры
- WebSocket-обновления статусов игроков в реальном времени

#### 3. Игра (game.html и game.js)
- Canvas-рендеринг игрового процесса
- Анимация монеты игрока и соперников
- Генерация препятствий
- Обработка столкновений
- Отправка и получение данных о позициях и счете через WebSocket

### Серверная часть

#### 1. Основной сервер (server.js)
- Настройка Express и Socket.IO
- Обработка HTTP и WebSocket-запросов
- Статичная раздача клиентских файлов
- API для получения данных о комнатах и пользователях

#### 2. Модуль управления комнатами (rooms.js)
- Управление жизненным циклом комнат
- Добавление/удаление игроков
- Управление статусами готовности
- Хранение данных о счете игроков

### Взаимодействие компонентов
1. Клиент подключается через WebSocket, отправляет данные из Telegram
2. Сервер сохраняет данные пользователя в telegramUsers.json
3. Клиент может создать или присоединиться к комнате
4. В комнате игроки отмечают готовность, запускается обратный отсчет
5. В игре клиенты обмениваются данными о позициях через WebSocket
6. Сервер координирует обмен данными между игроками в комнате

## WebSocket-события
1. `join` - Присоединение пользователя
2. `createRoom` - Создание комнаты
3. `joinRoom` - Присоединение к комнате
4. `ready` - Готовность игрока
5. `countdown` - Обратный отсчет
6. `gameStart` - Начало игры
7. `updatePosition` - Обновление позиции игрока
8. `playerMoved` - Движение других игроков
9. `updateScore` - Обновление счета игрока
10. `scoreUpdated` - Обновление счета для всех игроков

## Развертывание
1. Проект запускается через Docker Compose
2. Nginx используется для обработки HTTPS и раздачи статических файлов
3. SSL-сертификаты получаются через certbot
4. Сервер слушает порт 443 для HTTPS-подключений 